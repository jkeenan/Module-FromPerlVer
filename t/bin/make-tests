#!/bin/env  perl
########################################################################
# housekeeping
########################################################################

use 5.006;

use File::Basename  qw( basename dirname    );
use List::MoreUtils qw( zip                 );

########################################################################
# package variables
########################################################################

my $dir = ( dirname $0 ) . '/..';

my @test_verz
= qw
(
    5.5.3
    5.888.888
    5.999.999
);

my @formatz
= map
{
    (   $_, 'v' . $_ )
}
qw
(
    %d.%d.%d
    %d.03d.%03d
    %d.03d%03d
    %d.03d_%03d
);

my @v_stringz
= do
{
    map
    {
        my @argz    = split '.' => $_;

        map
        {
            my $f1  = $_;
            my $f2  = 'v' . $_;

            (
                sprintf( $f1 => @argz ),
                sprintf( $f2 => @argz ),
            )
        }
        @formatz
    }
    @versionz;
};

########################################################################
# symlink all of the test templates to version-specific paths.
########################################################################

chdir $dir
or die "Failed chdir: $dir, $!";

for my $path ( glob "bin/*_t" )
{
    print "# Link: '$path'\n";
    
    my $base    = basename $path => '_t';
    my $pref    
    = do
    {
        my $i   = index $base, '-';
        substr $base, 0, $i;
    };

    print "# Cleanup: '$pref-*'\n";

    unlink glob $pref . '-*';

    symlink $path => $_
    for map
    {
        (
            "$base-$_.t"  ,
            "$base-v$_.t" ,
        )
    }
    @versionz;
}

exit 0;
